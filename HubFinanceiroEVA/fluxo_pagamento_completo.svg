<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 900" style="background-color: #f8f9fa;">
    <!-- Definitions -->
    <defs>
        <filter id="shadow" x="-5%" y="-5%" width="110%" height="110%">
            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-color="#000000" flood-opacity="0.2" />
        </filter>
        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#333" />
        </marker>
    </defs>

    <!-- Title -->
    <text x="600" y="40" font-family="Arial, sans-serif" font-size="28" font-weight="bold" text-anchor="middle"
        fill="#2c3e50">EVA Financial Hub - Arquitetura Final de Pagamentos v3.0</text>

    <!-- Areas -->
    <!-- Frontend Area -->
    <rect x="50" y="80" width="300" height="750" rx="10" fill="#e3f2fd" stroke="#2196f3" stroke-width="2"
        filter="url(#shadow)" />
    <text x="200" y="110" font-family="Arial" font-size="20" font-weight="bold" fill="#1565c0"
        text-anchor="middle">Frontend (React)</text>

    <!-- Backend Area -->
    <rect x="400" y="80" width="400" height="750" rx="10" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2"
        filter="url(#shadow)" />
    <text x="600" y="110" font-family="Arial" font-size="20" font-weight="bold" fill="#7b1fa2"
        text-anchor="middle">Backend (FastAPI)</text>

    <!-- External/DB Area -->
    <rect x="850" y="80" width="300" height="750" rx="10" fill="#e8f5e9" stroke="#4caf50" stroke-width="2"
        filter="url(#shadow)" />
    <text x="1000" y="110" font-family="Arial" font-size="20" font-weight="bold" fill="#2e7d32"
        text-anchor="middle">Infra & Externos</text>

    <!-- Components: Frontend -->
    <g transform="translate(75, 150)">
        <rect width="250" height="120" rx="5" fill="#ffffff" stroke="#1565c0" stroke-width="1" />
        <text x="125" y="30" font-family="Arial" font-size="16" font-weight="bold"
            text-anchor="middle">CheckoutPage.jsx</text>
        <path d="M20,45 L230,45" stroke="#eee" stroke-width="1" />
        <text x="30" y="70" font-family="Arial" font-size="12" fill="#555">- Tabs: Card / Pix / Crypto / Wise</text>
        <text x="30" y="90" font-family="Arial" font-size="12" fill="#555">- Upload Receipt (Wise)</text>
        <text x="30" y="110" font-family="Arial" font-size="12" fill="#555">- QR Code Display</text>
    </g>

    <g transform="translate(75, 300)">
        <rect width="250" height="80" rx="5" fill="#ffffff" stroke="#1565c0" stroke-width="1" />
        <text x="125" y="30" font-family="Arial" font-size="16" font-weight="bold"
            text-anchor="middle">paymentService.js</text>
        <text x="30" y="60" font-family="Arial" font-size="12" fill="#555">Axios Client (Auth Bearer)</text>
    </g>

    <g transform="translate(75, 500)">
        <rect width="250" height="100" rx="5" fill="#fff3e0" stroke="#ef6c00" stroke-width="1" />
        <text x="125" y="30" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Protected
            Routes</text>
        <text x="30" y="60" font-family="Arial" font-size="12" fill="#555">/voices/clone (Gold)</text>
        <text x="30" y="80" font-family="Arial" font-size="12" fill="#555">/predicoes/analisar (Diamond)</text>
    </g>

    <!-- Components: Backend -->
    <g transform="translate(425, 150)">
        <rect width="350" height="180" rx="5" fill="#ffffff" stroke="#7b1fa2" stroke-width="1" />
        <text x="175" y="30" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">API Routes
            (Router)</text>

        <rect x="20" y="45" width="310" height="30" rx="3" fill="#e1bee7" />
        <text x="175" y="65" font-family="Arial" font-size="12" text-anchor="middle">POST
            /checkout/{stripe|asaas|bitcoin}</text>

        <rect x="20" y="85" width="310" height="30" rx="3" fill="#e1bee7" />
        <text x="175" y="105" font-family="Arial" font-size="12" text-anchor="middle">POST /webhooks/{provider}</text>

        <rect x="20" y="125" width="310" height="30" rx="3" fill="#e1bee7" />
        <text x="175" y="145" font-family="Arial" font-size="12" text-anchor="middle">POST
            /checkout/upload-receipt</text>
    </g>

    <g transform="translate(425, 360)">
        <rect width="350" height="120" rx="5" fill="#fff9c4" stroke="#fbc02d" stroke-width="1" />
        <text x="175" y="30" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Security &
            Middleware</text>
        <text x="30" y="60" font-family="Arial" font-size="12" fill="#333">1. verify_token (JWT)</text>
        <text x="30" y="80" font-family="Arial" font-size="12" fill="#333" font-weight="bold">2.
            require_subscription(tier) [NOVO]</text>
        <text x="30" y="100" font-family="Arial" font-size="12" fill="#333"> -> Bloqueia acesso free a rotas
            premium</text>
    </g>

    <g transform="translate(425, 520)">
        <rect width="350" height="200" rx="5" fill="#ffffff" stroke="#7b1fa2" stroke-width="1" />
        <text x="175" y="30" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Service
            Layer</text>

        <!-- Services Grid -->
        <rect x="20" y="45" width="150" height="30" rx="3" fill="#f3e5f5" stroke="#ba68c8" />
        <text x="95" y="65" font-family="Arial" font-size="11" text-anchor="middle">StripeService</text>

        <rect x="180" y="45" width="150" height="30" rx="3" fill="#f3e5f5" stroke="#ba68c8" />
        <text x="255" y="65" font-family="Arial" font-size="11" text-anchor="middle">AsaasService (Pix)</text>

        <rect x="20" y="85" width="150" height="30" rx="3" fill="#f3e5f5" stroke="#ba68c8" />
        <text x="95" y="105" font-family="Arial" font-size="11" text-anchor="middle">WiseService</text>

        <rect x="180" y="85" width="150" height="30" rx="3" fill="#f3e5f5" stroke="#ba68c8" />
        <text x="255" y="105" font-family="Arial" font-size="11" text-anchor="middle">StorageService (GCS)</text>

        <rect x="20" y="130" width="310" height="50" rx="3" fill="#d1c4e9" stroke="#673ab7" stroke-width="2" />
        <text x="175" y="150" font-family="Arial" font-size="12" font-weight="bold" text-anchor="middle">WebhookService
            [NOVO]</text>
        <text x="175" y="168" font-family="Arial" font-size="10" text-anchor="middle">Processa Confirma√ß√£o -> Ativa
            Assinatura</text>
    </g>

    <!-- Components: External/DB -->
    <g transform="translate(875, 150)">
        <rect width="250" height="200" rx="5" fill="#ffffff" stroke="#2e7d32" stroke-width="1" />
        <text x="125" y="30" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">PostgreSQL
            Database</text>

        <path d="M20,50 L230,50 M20,100 L230,100 M20,150 L230,150" stroke="#eee" />

        <text x="30" y="75" font-family="Arial" font-size="12" font-weight="bold">Table: Users</text>
        <text x="150" y="75" font-family="Arial" font-size="11" fill="#555">tier: 'gold'</text>

        <text x="30" y="125" font-family="Arial" font-size="12" font-weight="bold">Table: Transactions</text>
        <text x="150" y="125" font-family="Arial" font-size="11" fill="#555">status: 'paid'</text>

        <text x="30" y="175" font-family="Arial" font-size="12" font-weight="bold">Table: Subscriptions</text>
        <text x="150" y="175" font-family="Arial" font-size="11" fill="#555">end_date</text>
    </g>

    <g transform="translate(875, 400)">
        <rect width="250" height="140" rx="5" fill="#e0f2f1" stroke="#009688" stroke-width="1" />
        <text x="125" y="30" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">External
            APIs</text>
        <text x="30" y="60" font-family="Arial" font-size="12">üí≥ Stripe API</text>
        <text x="30" y="80" font-family="Arial" font-size="12">üí† Asaas API (Pix)</text>
        <text x="30" y="100" font-family="Arial" font-size="12">‚ö° OpenNode (BTC)</text>
        <text x="30" y="120" font-family="Arial" font-size="12">‚òÅÔ∏è Google Cloud Storage</text>
    </g>

    <!-- Connections -->
    <!-- Frontend to API -->
    <path d="M325,340 L415,240" stroke="#333" stroke-width="2" marker-end="url(#arrow)" fill="none" />
    <text x="340" y="280" font-family="Arial" font-size="11" fill="#333">POST /checkout</text>

    <!-- API to Service -->
    <path d="M600,330 L600,350" stroke="#333" stroke-width="2" marker-end="url(#arrow)" fill="none" />
    <path d="M600,480 L600,510" stroke="#333" stroke-width="2" marker-end="url(#arrow)" fill="none" />

    <!-- Service to External -->
    <path d="M775,600 L865,470" stroke="#333" stroke-width="2" marker-end="url(#arrow)" fill="none" />
    <text x="800" y="530" font-family="Arial" font-size="11" fill="#333">API Calls</text>

    <!-- External Webhook to API -->
    <path d="M1000,540 L1000,650 L750,650 L750,260" stroke="#f44336" stroke-width="2" stroke-dasharray="5,5"
        marker-end="url(#arrow)" fill="none" />
    <text x="850" y="670" font-family="Arial" font-size="11" fill="#f44336">Webhook Event</text>

    <!-- API Webhook to WebhookService -->
    <path d="M500,330 L500,650" stroke="#f44336" stroke-width="2" marker-end="url(#arrow)" fill="none" />

    <!-- WebhookService to DB -->
    <path d="M775,680 L875,300" stroke="#2196f3" stroke-width="3" marker-end="url(#arrow)" fill="none" />
    <text x="800" y="700" font-family="Arial" font-size="11" fill="#2196f3" font-weight="bold">Update Status & Unlock
        Tier</text>

    <!-- Frontend Protected Route to Middleware -->
    <path d="M325,550 L415,420" stroke="#ef6c00" stroke-width="2" marker-end="url(#arrow)" fill="none" />
    <text x="340" y="500" font-family="Arial" font-size="11" fill="#ef6c00">Try Access Premium</text>

    <!-- Middleware to DB -->
    <path d="M775,420 L865,250" stroke="#333" stroke-width="1" stroke-dasharray="2,2" marker-end="url(#arrow)"
        fill="none" />
    <text x="800" y="380" font-family="Arial" font-size="10" fill="#333">Check User Tier</text>

</svg>